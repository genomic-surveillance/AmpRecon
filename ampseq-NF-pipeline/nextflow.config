params {
    manifest = ""
    results_dir = "$launchDir/output/"
    reference_fasta = ""
    irods_manifest = ""
    help=""
    // --- intermediate manifests ---------------------------------------------
    manifest_step1_2=''
    // ------------------------------------------------------------------------
    start_from="1.1"
}


profiles {

	standard {
		docker {
			enabled = true
		}
		process {

			withName:bam_find_adapter {
				container = "quay.io/biocontainers/biobambam:2.0.182--h7d875b9_0"

			}
		}
	}

	sanger_default {

        docker {
            enabled = false
        }

        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "$PWD"
            runOptions = "--bind /lustre,/nfs,/software"
        }

        process {
            cpus = 1
            memory = "8GB"
            errorStrategy = {task.attempt <= 2 ? "retry" : "terminate"}
            maxRetries = 5

            // This is needed to make resume use the cache for the decode step
            withName: decode {
                cache = "deep"
            }
        }

        executor {
            name = "local"
        }
    }



}

process {
    // ---------------------| SET CONTAINERS |---------------------------------
    // --- Reference handling processes ---------------------------------------
    withName:indexReferenceBWA {
        container = "$projectDir/../containers/bwa.sif"
    }
    withName:generateFastaIndex {
        container = "$projectDir/../containers/samtools_1.15.sif"
    }
    withName:generateFastaDict {
        container = "$projectDir/../containers/picard.sif"
    }

    // --- Stage 1 - Step1 ----------------------------------------------------

    withName:basecalls_conversion {
        container = "$projectDir/../containers/bambi.sif"
    }
    withName:decode_multiplexed_bam {
        container = "$projectDir/../containers/bambi.sif"
    }
    withName:bam_find_adapter {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:get_taglist_file{
        container = "$projectDir/../containers/pythonBox.sif"
    }
    withName:collate_alignments {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:bam_reset {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:clip_adapters {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:bam_to_fastq {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:align_bam {
        container = "$projectDir/../containers/bwa.sif"
    }
    withName:bambi_select{
        container = "$projectDir/../containers/bambi.sif"
    }
    withName:scramble_sam_to_bam{
        container = "$projectDir/../containers/staden.sif"
    }
    withName:mapping_reheader {
        container = "$projectDir/../containers/mergeHeaders.sif"
    }
    withName:bam_split {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:bam_merge {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:alignment_filter {
        container = "$projectDir/../containers/bambi.sif"
    }
    withName:sort_bam {
        container = "$projectDir/../containers/biobambam2.sif"
    }
    withName:scramble_cram_to_bam{
        container = "$projectDir/../containers/staden.sif"
    }
}

{"version":"2.0","nodes":[{"use_STDIN":false,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","merge","-n","-O","BAM","-l","0","--input-fmt-option","no_ref=1","-","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/28877_1#1.cram"],"description":"merge individual cram files from a sample into one bam file","id":"crammerge"},{"description":"apply the spatial filter (produced in stage1)","id":"spatial_filter","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/bambi/0.11.2/bin/bambi","spatial_filter","-a","--compression-level","0","-f","-l",{"direction":"out","port":"apply_stats"},"-F","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/28877_1.spatial_filter","--rg","28877_1#1","-"]},{"name":"DUMMY","description":"spatial filter file","id":"spatial_filter_file","type":"INFILE"},{"id":"spatial_filter_stats","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.spatial_filter.stats","type":"OUTFILE"},{"cmd":["/software/sciops/pkg/bambi/0.11.2/bin/bambi","select","--compression-level","0","--input",{"packflag":[{"port":"phix_bam_in","direction":"in"},[",",{"direction":"in","port":"target_bam_in"}]]},"--output",{"packflag":[{"direction":"out","port":"phix_bam_out"},[",",{"direction":"out","port":"target_bam_out"}]]},"-m",{"direction":"out","port":"af_metrics"}],"type":"EXEC","use_STDOUT":true,"use_STDIN":false,"id":"alignment_filter"},{"type":"OUTFILE","name":"28877_1#1_bam_alignment_filter_metrics.json","id":"af_metrics"},{"type":"EXEC","cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-t",".","-v","-w",600,{"direction":"out","port":"straight_through1"},{"direction":"out","port":"straight_through2"},{"port":"subsample","direction":"out"}],"use_STDOUT":false,"use_STDIN":true,"id":"ssfqc_tee_ssfqc"},{"cmd":["/bin/bash -c '","tmfs=\"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/qc/28877_1.tag_metrics.json\"","; if [ ! -z \"${tmfs}\" ]; then for tag_metrics_file in ${tmfs}; do reads_count=`jq","'\"'\"'.reads_count.\"1\"'\"'\"'","${tag_metrics_file}`; reads_count=`echo ${reads_count} | tr -cd [:digit:]`; reads_count_total=$((${reads_count_total}+${reads_count})); done; frac=`echo \"10000/${reads_count_total}\" | bc -l`; fi;","if [ ! -z $frac ]; then","samtools","view","-s","28877${frac}","-b","-",";","else >&2 printf \"No tag metrics, no subsample\"; fi;'"],"type":"EXEC","use_STDOUT":true,"use_STDIN":true,"id":"ssfqc_subsample","subtype":"STRINGIFY"},{"use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","fastq","-F","0x200","-1",{"direction":"out","port":"ss_fq1"},"-2",{"port":"ss_fq2","direction":"out"},"-"],"id":"ssfqc_bamtofastq_ss"},{"description":"lane-level fastq output, read1","id":"ssfqc_run_lane_ss_fq1","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/.npg_cache_10000/28877_1#1_1.fastq","type":"OUTFILE"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/.npg_cache_10000/28877_1#1_2.fastq","description":"lane-level fastq output, read2","id":"ssfqc_run_lane_ss_fq2"},{"id":"aln_bamcollate2","type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamcollate2","collate=1","level=0"],"comment":"ensure BAM records are gathered by template i.e. queryname","use_STDIN":true,"use_STDOUT":true},{"id":"aln_alignment_reference_genome","description":"Prefix for reference fasta and Bowtie2 index files","name":"/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/bwa0_6/Pf_GRC2v1.0.fasta","type":"INFILE"},{"type":"INFILE","id":"aln_alignment_reference_dict","description":"Extra metadata e.g. UR, M5 auxtags for BAM SQ header records","name":"/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/picard/Pf_GRC2v1.0.fasta.dict"},{"id":"aln_bam12auxmerge","type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bam12auxmerge","level=0","rankstrip=1","ranksplit=0","zztoname=0","clipreinsert=1",{"port":"no_aln_bam","direction":"in"}],"use_STDOUT":true,"use_STDIN":true},{"type":"RAFILE","name":"./initial_phix_aln_28877_1#1.bam","id":"aln_initial_phix_aln_bam"},{"name":"tmp2.bam","id":"aln_initial_phix_aln_bam2","type":"RAFILE"},{"cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","30000","-m","1G",{"port":"to_tgtaln","direction":"out"},{"direction":"out","port":"to_phix_aln"},{"port":"to_amp","direction":"out"}],"type":"EXEC","comment":"large wait (500 minutes) to avoid unnecessary spill to disk; specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDIN":true,"use_STDOUT":false,"id":"aln_tee3_tee3"},{"id":"aln_amp_bamreset_pre_auxmerge","comment":"bam12auxmerge <= 0.0.142 requires SQ headers removed. Alignment removal also required for bamadapterclip (at least 0.0.142)","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamreset","resetaux=0","level=0","verbose=0"]},{"id":"aln_amp_bamadapterclip_pre_auxmerge","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamadapterclip","verbose=0","level=0"],"type":"EXEC","use_STDIN":true,"use_STDOUT":true},{"id":"aln_prealn_bamcollate2_ranking","use_STDIN":true,"comment":"already collated suitably - just here to do the ranking in the name","use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamcollate2","collate=3","level=0"]},{"use_STDOUT":true,"comment":"Alignment removal also required for bamadapterclip (at least 0.0.142)","use_STDIN":true,"cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamreset","resetaux=0","level=0","verbose=0"],"type":"EXEC","id":"aln_prealn_bamreset_pre_alignment"},{"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamadapterclip","verbose=0","level=0"],"use_STDOUT":true,"use_STDIN":true,"description":"Hard clip adapter sequence from reads before feeding to Tophat2","id":"aln_prealn_bamadapterclip"},{"id":"aln_alntgt_bamtofastq","use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamtofastq"]},{"type":"EXEC","cmd":["/software/sciops/pkg/bwa-aligner/0.7.17/bin/bwa","mem","-t","24","-p","-Y","-K","100000000",{"direction":"in","port":"db_prefix_reference_genome"},{"port":"fq","direction":"in"}],"use_STDOUT":true,"use_STDIN":false,"comment":"presuming interleaved FR fastq records (-p flag), output all records (-T 0)","id":"aln_alntgt_bwa_mem"},{"id":"aln_alntgt_samtobam","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/staden_io_bin/1.14.9/bin/scramble","-0","-I","sam","-O","bam"],"type":"EXEC"},{"comment":"get deadlock when tee used here; specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDOUT":false,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","300","-m","100M",{"port":"header_fix","direction":"out"},{"direction":"out","port":"full_bam"}],"id":"aln_postaln_tee_headerSQfix"},{"id":"aln_postaln_sam_headerSQfix","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","view","-h","-"],"type":"EXEC","use_STDOUT":true,"use_STDIN":true},{"id":"aln_postaln_alterSQ_headerSQfix","description":"where SN field in SQ header record matches one in the given dict file, replace that SQ record with that in the dict file, but propagate any 'AH' fields provided by the aligner","cmd":["/software/solexa/pkg/perl/5.22.2/bin/perl","-nle","use strict; use autodie; our%sq; our$re; our$body; BEGIN{$body=0; $re=qr/^\\@SQ.*\\tSN:([^\\t]+)/; open(my$df,q(<),shift@ARGV); while(<$df>){chomp; if(/$re/){$sq{$1}=$_;} } close $df; } next if $body ; if(/$re/){ if(my$nsq=$sq{$1}){my@ah=grep{/^AH:/}split qq(\\t),$_; $_=join qq(\\t),$nsq,@ah;} }elsif(/^[^@]/){open STDOUT,q(>),q(/dev/null); $body=1; next} print",{"port":"picard_dict","direction":"in"}],"type":"EXEC","comment":"careful to not send SIGPIPE back to tee, yet ensure EOF to reheader as soon as header processed, separate arguments to avoid being wrapped by a shell (which might hang onto file handles breaking this intention)","use_STDIN":true,"use_STDOUT":true},{"id":"aln_postaln_mbuffer_headerSQfix","type":"EXEC","cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-m","5M","-"],"use_STDOUT":true,"use_STDIN":true},{"id":"aln_postaln_reheader_headerSQfix","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","reheader",{"direction":"in","port":"samheader"},{"port":"bam","direction":"in"}],"type":"EXEC","use_STDIN":false,"use_STDOUT":true},{"id":"aln_postaln_bam12split","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bam12split","verbose=0","level=0"],"type":"EXEC"},{"id":"foptgt_bam_stats","type":"EXEC","cmd":["/software/sciops/pkg/bam_stats/1.13.0/bin/bam_stats","-r","/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/fasta/Pf_GRC2v1.0.fasta","-o","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.bam_stats"],"use_STDIN":true,"comment":"CGP bam_stats","use_STDOUT":false},{"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamsort","threads=24","SO=coordinate","level=0","verbose=0","fixmate=1","adddupmarksupport=1","tmpfile=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/bsfopt_28877_1#1.tmp"],"use_STDOUT":true,"use_STDIN":true,"id":"foptgt_bamsort_coord"},{"id":"foptgt_bmd_multiway","use_STDIN":true,"comment":"specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDOUT":false,"cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","300",{"port":"scramble","direction":"out"},{"direction":"out","port":"flagstat"},{"direction":"out","port":"bam"},{"direction":"out","port":"samtools_stats_F0x900"},{"port":"samtools_stats_F0xB00","direction":"out"},{"direction":"out","port":"bam_stats"},{"direction":"out","port":"seqchksum"},{"direction":"out","port":"seqchksum_extrahash"}],"type":"EXEC"},{"use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/staden_io_bin/1.14.9/bin/scramble","-t","11","-7","-I","bam","-O","cram","-r","/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/fasta/Pf_GRC2v1.0.fasta","-e"],"id":"foptgt_scramble"},{"cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","30000",{"port":"cram","direction":"out"},{"direction":"out","port":"crai"},{"direction":"out","port":"md5"},{"port":"seqchksum","direction":"out"}],"type":"EXEC","use_STDOUT":false,"comment":"allow a generous 500 minutes for the teepot timeout; specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDIN":true,"id":"foptgt_scramble_tee"},{"id":"foptgt_scramble_md5","cmd":"/usr/bin/md5sum","type":"EXEC","use_STDIN":true,"use_STDOUT":true},{"id":"foptgt_postprocess_md5","comment":"the double-backslash is required to get the correct character set to the tr command","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/usr/bin/tr","-d"," \\-\n"]},{"cmd":["/software/sciops/pkg/staden_io_bin/1.14.9/bin/cram_index","-","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.cram.crai"],"type":"EXEC","use_STDIN":true,"use_STDOUT":false,"id":"foptgt_cram_index"},{"id":"foptgt_cram_seqchksum","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum","inputformat=cram"]},{"id":"foptgt_samtools_stats_F0x900","use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","stats","-r","/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/fasta/Pf_GRC2v1.0.fasta","-F","0x900","-"]},{"id":"foptgt_samtools_stats_F0xB00","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","stats","-r","/lustre/scratch117/core/sciops_repository/gbs_plex/PFA_GRC2_v1.0/v6/all/fasta/Pf_GRC2v1.0.fasta","-F","0xB00","-"],"type":"EXEC"},{"use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum"],"id":"foptgt_seqchksum"},{"id":"foptgt_seqchksum_extrahash","type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum","hash=sha512primesums512"],"use_STDIN":true,"comment":"default hash type is currently sha512primesums512","use_STDOUT":true},{"id":"foptgt_bamrecompress","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamrecompress","verbose=0","index=1","indexfilename=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.bai","md5=1","md5filename=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.bam.md5","numthreads=11","tmpfile=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/brfopt_28877_1#1.tmp"],"type":"EXEC"},{"id":"foptgt_bam_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.bam","type":"OUTFILE"},{"name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.cram","id":"foptgt_cram_file","type":"OUTFILE"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.cram.md5","id":"foptgt_cram_md5"},{"name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.seqchksum","id":"foptgt_seqchksum_file","type":"RAFILE"},{"type":"RAFILE","comment":"this file is a temporary fix for blocking problems at the cmp_seqchksum node","name":"./28877_1#1.cram.seqchksum","id":"foptgt_seqchksum_file_cram"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.sha512primesums512.seqchksum","id":"foptgt_seqchksum_extrahash_file"},{"id":"foptgt_stats_F0x900_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_F0x900.stats","type":"OUTFILE"},{"id":"foptgt_stats_F0xB00_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_F0xB00.stats","type":"OUTFILE"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.flagstat","id":"foptgt_flagstat_file"},{"id":"foptgt_flagstat_filter","description":"Filter out secondary and supplementary alignment records","type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","view","-u","-F","0x900","-"],"use_STDIN":true,"use_STDOUT":true},{"cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","flagstat","-"],"type":"EXEC","use_STDIN":true,"use_STDOUT":true,"id":"foptgt_flagstat"},{"use_STDIN":false,"use_STDOUT":true,"type":"EXEC","cmd":["/usr/bin/cmp",{"direction":"in","port":"bam_seqchksum"},{"direction":"in","port":"cram_seqchksum"}],"id":"foptgt_cmp_seqchksum"},{"type":"EXEC","cmd":["/software/sciops/pkg/bam_stats/1.13.0/bin/bam_stats","-r","/lustre/scratch117/core/sciops_repository/references/PhiX/Sanger-SNPs/all/fasta/phix_unsnipped_short_no_N.fa","-o","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.bam_stats"],"use_STDIN":true,"comment":"CGP bam_stats","use_STDOUT":false,"id":"fopphx_bam_stats"},{"id":"fopphx_bamsort_coord","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamsort","threads=24","SO=coordinate","level=0","verbose=0","fixmate=1","adddupmarksupport=1","tmpfile=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/bsfopp_28877_1#1_phix.tmp"],"type":"EXEC"},{"id":"fopphx_bammarkduplicates","use_STDOUT":true,"comment":"default tool bamstreamingmarkduplicates must be from Biobambam >= 0.0.174","use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamstreamingmarkduplicates","level=0","verbose=0","tmpfile=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/bmdfopp_28877_1#1_phix.tmp","M=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.markdups_metrics.txt"]},{"id":"fopphx_bmd_multiway","cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","300",{"direction":"out","port":"scramble"},{"port":"flagstat","direction":"out"},{"direction":"out","port":"bam"},{"direction":"out","port":"samtools_stats_F0x900"},{"port":"samtools_stats_F0xB00","direction":"out"},{"port":"bam_stats","direction":"out"},{"port":"seqchksum","direction":"out"},{"port":"seqchksum_extrahash","direction":"out"}],"type":"EXEC","use_STDIN":true,"comment":"specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDOUT":false},{"id":"fopphx_scramble","type":"EXEC","cmd":["/software/sciops/pkg/staden_io_bin/1.14.9/bin/scramble","-t","11","-7","-I","bam","-O","cram","-r","/lustre/scratch117/core/sciops_repository/references/PhiX/Sanger-SNPs/all/fasta/phix_unsnipped_short_no_N.fa"],"use_STDOUT":true,"use_STDIN":true},{"cmd":["/software/sciops/pkg/teepot/1.2.0/bin/teepot","-v","-t",".","-w","30000",{"port":"cram","direction":"out"},{"direction":"out","port":"crai"},{"port":"md5","direction":"out"},{"port":"seqchksum","direction":"out"}],"type":"EXEC","use_STDIN":true,"comment":"allow a generous 500 minutes for the teepot timeout; specify parameter value teepot_tempdir_value to specify teepot tempdir","use_STDOUT":false,"id":"fopphx_scramble_tee"},{"id":"fopphx_scramble_md5","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":"/usr/bin/md5sum"},{"type":"EXEC","cmd":["/usr/bin/tr","-d"," \\-\n"],"comment":"the double-backslash is required to get the correct character set to the tr command","use_STDOUT":true,"use_STDIN":true,"id":"fopphx_postprocess_md5"},{"id":"fopphx_cram_index","cmd":["/software/sciops/pkg/staden_io_bin/1.14.9/bin/cram_index","-","/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.cram.crai"],"type":"EXEC","use_STDIN":true,"use_STDOUT":false},{"use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum","inputformat=cram"],"id":"fopphx_cram_seqchksum"},{"id":"fopphx_samtools_stats_F0x900","use_STDIN":true,"use_STDOUT":true,"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","stats","-r","/lustre/scratch117/core/sciops_repository/references/PhiX/Sanger-SNPs/all/fasta/phix_unsnipped_short_no_N.fa","-F","0x900","-"]},{"id":"fopphx_samtools_stats_F0xB00","use_STDOUT":true,"use_STDIN":true,"cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","stats","-r","/lustre/scratch117/core/sciops_repository/references/PhiX/Sanger-SNPs/all/fasta/phix_unsnipped_short_no_N.fa","-F","0xB00","-"],"type":"EXEC"},{"id":"fopphx_seqchksum","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum"],"type":"EXEC","use_STDIN":true,"use_STDOUT":true},{"id":"fopphx_seqchksum_extrahash","comment":"default hash type is currently sha512primesums512","use_STDOUT":true,"use_STDIN":true,"type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum","hash=sha512primesums512"]},{"id":"fopphx_bamrecompress","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamrecompress","verbose=0","index=1","indexfilename=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.bai","md5=1","md5filename=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.bam.md5","numthreads=11","tmpfile=/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/brfopp_28877_1#1_phix.tmp"],"type":"EXEC","use_STDIN":true,"use_STDOUT":true},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.bam","id":"fopphx_bam_file"},{"type":"OUTFILE","id":"fopphx_cram_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.cram"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.cram.md5","id":"fopphx_cram_md5"},{"type":"RAFILE","id":"fopphx_seqchksum_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.seqchksum"},{"type":"RAFILE","comment":"this file is a temporary fix for blocking problems at the cmp_seqchksum node","id":"fopphx_seqchksum_file_cram","name":"./28877_1#1_phix.cram.seqchksum"},{"type":"OUTFILE","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.sha512primesums512.seqchksum","id":"fopphx_seqchksum_extrahash_file"},{"type":"OUTFILE","id":"fopphx_stats_F0x900_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix_F0x900.stats"},{"id":"fopphx_stats_F0xB00_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix_F0xB00.stats","type":"OUTFILE"},{"type":"OUTFILE","id":"fopphx_flagstat_file","name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1_phix.flagstat"},{"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","view","-u","-F","0x900","-"],"use_STDOUT":true,"use_STDIN":true,"id":"fopphx_flagstat_filter","description":"Filter out secondary and supplementary alignment records"},{"type":"EXEC","cmd":["/software/sciops/pkg/samtools/1.9+48_g2d4907c/bin/samtools","flagstat","-"],"use_STDIN":true,"use_STDOUT":true,"id":"fopphx_flagstat"},{"use_STDOUT":true,"use_STDIN":false,"type":"EXEC","cmd":["/usr/bin/cmp",{"direction":"in","port":"bam_seqchksum"},{"direction":"in","port":"cram_seqchksum"}],"id":"fopphx_cmp_seqchksum"},{"id":"scs_seqchksum_input","type":"EXEC","cmd":["/software/sciops/pkg/biobambam2/2.0.79/bin/bamseqchksum"],"use_STDOUT":true,"use_STDIN":true},{"name":"/nfs/sf55/IL_seq_data/analysis/190327_MS7_28877_A_MS7940394-300V2/Data/Intensities/BAM_basecalls_20190328-133730/no_cal/archive/lane1/plex1/28877_1#1.orig.seqchksum","id":"scs_seqchksum_orig_file","description":"bamseqchksum output file","type":"RAFILE"},{"use_STDOUT":true,"use_STDIN":false,"cmd":["/software/npg/20190314/bin/seqchksum_merge.pl",{"port":"target_chksum","direction":"in"},{"port":"phix_chksum","direction":"in"}],"type":"EXEC","id":"scs_merge_output_seqchksum"},{"use_STDIN":false,"use_STDOUT":false,"type":"EXEC","cmd":["/usr/bin/cmp",{"port":"inputchk","direction":"in"},{"direction":"in","port":"outputchk"}],"description":"check input primary/sequence data matches output","id":"scs_cmp_seqchksum"}],"edges":[{"from":"crammerge","id":"src_to_bc2","to":"spatial_filter"},{"id":"apply_filter_to_sfqc","to":"spatial_filter_stats","from":"spatial_filter:apply_stats"},{"id":"sf_to_bc2","to":"ssfqc_tee_ssfqc","from":"spatial_filter"},{"from":"ssfqc_tee_ssfqc:straight_through1","id":"ssfqc_to_tgtaln","to":"aln_bamcollate2"},{"to":"alignment_filter:target_bam_in","id":"target_alignment_to_alignment_filter","from":"aln_bam12auxmerge"},{"from":"aln_tee3_tee3:to_phix_aln","id":"iab_to_alignment_filter","to":"alignment_filter:phix_bam_in"},{"from":"alignment_filter:af_metrics","to":"af_metrics","id":"alignment_filter_to_metrics"},{"id":"af_to_paf_target","to":"foptgt_bamsort_coord","from":"alignment_filter:target_bam_out"},{"from":"alignment_filter:phix_bam_out","id":"af_to_paf_phix","to":"fopphx_bamsort_coord"},{"to":"scs_seqchksum_input","id":"src_to_seqchksum","from":"ssfqc_tee_ssfqc:straight_through2"},{"to":"scs_merge_output_seqchksum:target_chksum","id":"fopt_to_bam","from":"foptgt_seqchksum_file"},{"from":"fopphx_seqchksum_file","to":"scs_merge_output_seqchksum:phix_chksum","id":"fopp_to_bam_phix"},{"to":"ssfqc_subsample","id":"tee_to_ss","from":"ssfqc_tee_ssfqc:subsample"},{"from":"ssfqc_subsample","to":"ssfqc_bamtofastq_ss","id":"ss_to_b2fqss"},{"to":"ssfqc_run_lane_ss_fq1","id":"b2fqss_to_fq1","from":"ssfqc_bamtofastq_ss:ss_fq1"},{"from":"ssfqc_bamtofastq_ss:ss_fq2","id":"b2fqss_to_fq2","to":"ssfqc_run_lane_ss_fq2"},{"id":"bc2_to_t3","to":"aln_tee3_tee3","from":"aln_bamcollate2"},{"to":"aln_amp_bamreset_pre_auxmerge","id":"phixaln_to_amp","from":"aln_tee3_tee3:to_amp"},{"to":"aln_bam12auxmerge:no_aln_bam","id":"amp_to_auxmrg","from":"aln_amp_bamadapterclip_pre_auxmerge"},{"id":"tgtaln_to_prealn","to":"aln_prealn_bamcollate2_ranking","from":"aln_tee3_tee3:to_tgtaln"},{"to":"aln_alntgt_bamtofastq","id":"prealn_to_tee","from":"aln_prealn_bamadapterclip"},{"from":"aln_alignment_reference_genome","id":"ref_to_alignment","to":"aln_alntgt_bwa_mem:db_prefix_reference_genome"},{"from":"aln_alntgt_samtobam","id":"alignment_to_postaln","to":"aln_postaln_tee_headerSQfix"},{"from":"aln_alignment_reference_dict","id":"refdict_to_postaln","to":"aln_postaln_alterSQ_headerSQfix:picard_dict"},{"from":"aln_postaln_bam12split","id":"postaln_to_auxmrg","to":"aln_bam12auxmerge"},{"from":"aln_amp_bamreset_pre_auxmerge","id":"bamreset_to_bamadapterclip","to":"aln_amp_bamadapterclip_pre_auxmerge"},{"id":"bamcollate2_ranking_to_bamreset_prealn","to":"aln_prealn_bamreset_pre_alignment","from":"aln_prealn_bamcollate2_ranking"},{"id":"bamreset_prealn_to_bamadapterclip","to":"aln_prealn_bamadapterclip","from":"aln_prealn_bamreset_pre_alignment"},{"to":"aln_alntgt_bwa_mem:fq","id":"bamtofastq_to_int_fq","from":"aln_alntgt_bamtofastq"},{"from":"aln_alntgt_bwa_mem","id":"bwa_mem_to_scramble","to":"aln_alntgt_samtobam"},{"to":"aln_postaln_sam_headerSQfix","id":"tee_headerSQfix_to_sam","from":"aln_postaln_tee_headerSQfix:header_fix"},{"from":"aln_postaln_sam_headerSQfix","to":"aln_postaln_alterSQ_headerSQfix","id":"sam_headerSQfix_to_alterSQ"},{"from":"aln_postaln_alterSQ_headerSQfix","to":"aln_postaln_reheader_headerSQfix:samheader","id":"alterSQ_headerSQfix_to_reheader"},{"from":"aln_postaln_tee_headerSQfix:full_bam","to":"aln_postaln_mbuffer_headerSQfix","id":"tee_headerSQfix_to_mbuffer"},{"from":"aln_postaln_mbuffer_headerSQfix","to":"aln_postaln_reheader_headerSQfix:bam","id":"mbuffer_headerSQfix_to_reheader"},{"from":"aln_postaln_reheader_headerSQfix","id":"reheader_headerSQfix_to_bam12split","to":"aln_postaln_bam12split"},{"to":"foptgt_scramble","id":"bmdmw_to_scramble","from":"foptgt_bmd_multiway:scramble"},{"from":"foptgt_scramble","to":"foptgt_scramble_tee","id":"scramble_to_scramble_tee"},{"from":"foptgt_scramble_tee:md5","id":"scramble_tee_to_md5","to":"foptgt_scramble_md5"},{"to":"foptgt_cram_index","id":"scramble_tee_to_crai","from":"foptgt_scramble_tee:crai"},{"from":"foptgt_scramble_tee:seqchksum","to":"foptgt_cram_seqchksum","id":"scramble_tee_to_bscs"},{"to":"foptgt_postprocess_md5","id":"md5_to_postprocess","from":"foptgt_scramble_md5"},{"to":"foptgt_samtools_stats_F0x900","id":"bmdmw_to_sts_F0x900","from":"foptgt_bmd_multiway:samtools_stats_F0x900"},{"from":"foptgt_bmd_multiway:samtools_stats_F0xB00","to":"foptgt_samtools_stats_F0xB00","id":"bmdmw_to_sts_F0xB00"},{"from":"foptgt_bmd_multiway:bam_stats","id":"bmdmw_to_bam_stats","to":"foptgt_bam_stats"},{"to":"foptgt_seqchksum","id":"bmdmw_to_seqchksum","from":"foptgt_bmd_multiway:seqchksum"},{"id":"bmdmw_to_seqchksum_extrahash","to":"foptgt_seqchksum_extrahash","from":"foptgt_bmd_multiway:seqchksum_extrahash"},{"from":"foptgt_bmd_multiway:flagstat","to":"foptgt_flagstat_filter","id":"bmdmw_to_flagstat"},{"from":"foptgt_flagstat_filter","to":"foptgt_flagstat","id":"flagstat_filter_to_flagstat"},{"id":"bmd_to_bam","to":"foptgt_bamrecompress","from":"foptgt_bmd_multiway:bam"},{"id":"brc_to_bam","to":"foptgt_bam_file","from":"foptgt_bamrecompress"},{"from":"foptgt_scramble_tee:cram","id":"tee_to_cram","to":"foptgt_cram_file"},{"to":"foptgt_cram_md5","id":"corrected_md5_out","from":"foptgt_postprocess_md5"},{"from":"foptgt_seqchksum","id":"scs_to_tee","to":"foptgt_seqchksum_file"},{"id":"scs_file_to_cmp","to":"foptgt_cmp_seqchksum:bam_seqchksum","from":"foptgt_seqchksum_file"},{"id":"scs_extrahash_to_file","to":"foptgt_seqchksum_extrahash_file","from":"foptgt_seqchksum_extrahash"},{"to":"foptgt_stats_F0x900_file","id":"samtools_stats_F0x900_to_file","from":"foptgt_samtools_stats_F0x900"},{"from":"foptgt_samtools_stats_F0xB00","to":"foptgt_stats_F0xB00_file","id":"samtools_stats_F0xB00_to_file"},{"to":"foptgt_flagstat_file","id":"flagstat_to_file","from":"foptgt_flagstat"},{"from":"foptgt_cram_seqchksum","id":"cscs_to_file","to":"foptgt_seqchksum_file_cram"},{"from":"foptgt_seqchksum_file_cram","to":"foptgt_cmp_seqchksum:cram_seqchksum","id":"cscsfile_to_cmp"},{"to":"fopphx_bammarkduplicates","id":"bamsort_to_bammarkduplicates","from":"fopphx_bamsort_coord"},{"from":"fopphx_bammarkduplicates","to":"fopphx_bmd_multiway","id":"bammarkduplicates_to_multiway"},{"to":"fopphx_scramble","id":"bmdmw_to_scramble","from":"fopphx_bmd_multiway:scramble"},{"from":"fopphx_scramble","to":"fopphx_scramble_tee","id":"scramble_to_scramble_tee"},{"id":"scramble_tee_to_md5","to":"fopphx_scramble_md5","from":"fopphx_scramble_tee:md5"},{"from":"fopphx_scramble_tee:crai","to":"fopphx_cram_index","id":"scramble_tee_to_crai"},{"from":"fopphx_scramble_tee:seqchksum","to":"fopphx_cram_seqchksum","id":"scramble_tee_to_bscs"},{"from":"fopphx_scramble_md5","id":"md5_to_postprocess","to":"fopphx_postprocess_md5"},{"to":"fopphx_samtools_stats_F0x900","id":"bmdmw_to_sts_F0x900","from":"fopphx_bmd_multiway:samtools_stats_F0x900"},{"from":"fopphx_bmd_multiway:samtools_stats_F0xB00","id":"bmdmw_to_sts_F0xB00","to":"fopphx_samtools_stats_F0xB00"},{"from":"fopphx_bmd_multiway:bam_stats","id":"bmdmw_to_bam_stats","to":"fopphx_bam_stats"},{"to":"fopphx_seqchksum","id":"bmdmw_to_seqchksum","from":"fopphx_bmd_multiway:seqchksum"},{"from":"fopphx_bmd_multiway:seqchksum_extrahash","to":"fopphx_seqchksum_extrahash","id":"bmdmw_to_seqchksum_extrahash"},{"id":"bmdmw_to_flagstat","to":"fopphx_flagstat_filter","from":"fopphx_bmd_multiway:flagstat"},{"to":"fopphx_flagstat","id":"flagstat_filter_to_flagstat","from":"fopphx_flagstat_filter"},{"from":"fopphx_bmd_multiway:bam","id":"bmd_to_bam","to":"fopphx_bamrecompress"},{"id":"brc_to_bam","to":"fopphx_bam_file","from":"fopphx_bamrecompress"},{"from":"fopphx_scramble_tee:cram","id":"tee_to_cram","to":"fopphx_cram_file"},{"to":"fopphx_cram_md5","id":"corrected_md5_out","from":"fopphx_postprocess_md5"},{"from":"fopphx_seqchksum","to":"fopphx_seqchksum_file","id":"scs_to_tee"},{"to":"fopphx_cmp_seqchksum:bam_seqchksum","id":"scs_file_to_cmp","from":"fopphx_seqchksum_file"},{"from":"fopphx_seqchksum_extrahash","id":"scs_extrahash_to_file","to":"fopphx_seqchksum_extrahash_file"},{"id":"samtools_stats_F0x900_to_file","to":"fopphx_stats_F0x900_file","from":"fopphx_samtools_stats_F0x900"},{"from":"fopphx_samtools_stats_F0xB00","to":"fopphx_stats_F0xB00_file","id":"samtools_stats_F0xB00_to_file"},{"to":"fopphx_flagstat_file","id":"flagstat_to_file","from":"fopphx_flagstat"},{"id":"cscs_to_file","to":"fopphx_seqchksum_file_cram","from":"fopphx_cram_seqchksum"},{"to":"fopphx_cmp_seqchksum:cram_seqchksum","id":"cscsfile_to_cmp","from":"fopphx_seqchksum_file_cram"},{"id":"seqchksum_input_to_cmp","to":"scs_seqchksum_orig_file","from":"scs_seqchksum_input"},{"to":"scs_cmp_seqchksum:inputchk","id":"seqchksum_input_to_cmp","from":"scs_seqchksum_orig_file"},{"from":"scs_merge_output_seqchksum","id":"bamcat_to_chk_output","to":"scs_cmp_seqchksum:outputchk"},{"to":"foptgt_bmd_multiway","id":"foptgt_bamsort_coord_to_foptgt_bmd_multiway","from":"foptgt_bamsort_coord"}]}
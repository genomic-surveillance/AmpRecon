

params {
    input_params_csv = 'input.csv'
    mode = 'in-country'
}


profiles {

  standard {
    singularity {
        enabled = true
        autoMounts = true
        cacheDir = "./"
        runOptions = "--bind /lustre,/nfs,/software"
	    envWhitelist = "REF_PATH"

    }

    process{

        withName:GET_TAG_LIST_FILE{
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/pythonBox.sif'
        }
        withName:BAMBI_I2B {
            container = 'gitlab-registry.internal.sanger.ac.uk/malariagen1/amplicon-legacy/amplicon-pipeline-dependencies:0.9'
        }

    }
  }

  sanger_default {

        docker {
            enabled = false
        }

        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "$PWD"
            runOptions = "--bind /lustre,/nfs,/software"
        }

        process {
            cpus = 1
            memory = "8GB"
            errorStrategy = {task.attempt <= 2 ? "retry" : "terminate"}
            maxRetries = 5

            // This is needed to make resume use the cache for the decode step
            withName: decode {
                cache = "deep"
            }

            withName:GET_TAG_LIST_FILE{
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/pythonBox.sif'
        }
            withName:BAMBI_I2B {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/bambi.sif'
        }
            withName:BAMBI_DECODE {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/bambi.sif'
        }
            withName: BAMADAPTERFIND {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/biobambam2.sif'

        }
            withName: SAMTOOLS_SPLIT {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/samtools_1.15.sif'

         }
            withName: BAMCOLLATE2 {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/biobambam2.sif'

         }
            withName: BAMRESET {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/biobambam2.sif'

         }
            withName: CLIP_ADAPTERS {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/biobambam2.sif'

         }
            withName: BAM_TO_FASTQ {
            container = '/lustre/scratch118/malaria/team112/ss52/amp-restructure/ampseq-pipeline/ampseq-pipeline/ampseq-NF-pipeline/biobambam2.sif'

         }

  }

        executor {
            name = "local"
        }
    }
}
